---
layout: post
title: 'AWS EC2 vs AWS Lambda'
subtitle: 'AWS EC2 vs AWS Lambda'
categories: Infra
comments: false
---

# 정의 및 특징

### EC2

AWS EC2(Amazon Web Services Elastic Compute Cloud)는 클라우드에서 EC2 인스턴스라는 가상 머신을 사용하고 확장성을 제공하는 서비스이다.

- 필요할 때마다 디스크 공간, CPU 성능, 메모리 등을 변경할 수 있다.
- Linux 또는 Windows와 같이 필요한 사전 설치된 운영 체제(OS)가 있는 기본 이미지를 선택한 다음 대부분의 OS 설정을 구성하고 사용자 지정 응용 프로그램을 설치할 수 있다.
- Amazon EC2 인스턴스에 대한 루트 액세스 권한이 있으며 추가 사용자를 생성할 수 있다.
- AWS EC2 웹 서비스의 범주는 IaaS(Infrastructure as a Service)로 알려져 있다.
- AWS EC2는 클라우드 호스팅에 사용할 수 있다. 클라우드에서 서버를 가상 머신(인스턴스)으로 배포할 수 있다.

### Lambda

- AWS Lambda는 이벤트에 연결된 트리거가 실행될 때 지원되는 프로그래밍 언어(Java, JavaScript 또는 Python) 중 하나로 작성된 코드를 실행할 수 있는 컴퓨팅 플랫폼이다.
- 작성한 애플리케이션을 실행하기 위해 가상 서버와 환경을 구성할 필요가 없다.
- AWS Lambda 인터페이스에 프로그램 코드(= Lambda 함수)를 삽입하고 Lambda 함수를 이벤트와 연결하고 필요할 때 서버 관리 및 환경 구성을 돌보지 않고 클라우드에서 애플리케이션을 실행하기만 하면 된다. 서버 관리를 하지 않아도 돼서 애플리케이션에 집중할 수 있다. 이러한 특징 때문에 AWS Lambda를 서버리스(Severless)라고 한다.
- 애플리케이션이 실행된 후 이벤트는 Amazon S3 버킷에 파일 업로드, DynamoDB 테이블 변경, API Gateway 서비스에 대한 HTTP 요청 수신 등을 수행할 수 있다.
- 이벤트가 발생할 때 실행할 함수를 구성한 후 애플리케이션은 새로운 이벤트가 있을 때마다 자동으로 실행된다.
- Lambda는 Amazon의 FaaS(Function as a Service)의 일종이다.
- AWS Lambda는 인프라 구성이 아닌 코드 작성에 집중할 수 있다.

# ****사용 사례****

### EC2

- 웹사이트 호스팅
- 애플리케이션 개발 및 테스트
- 고성능 컴퓨팅

### Lambda

- 작업 자동화
- S3에 업로드된 객체 처리
- 실시간 로그 분석
- 실시간 필터링 및 데이터 변환
- 웹 사이트가 Amazon S3 버킷을 사용하여 사진, 비디오, 오디오 파일 등을 포함한 웹 사이트 콘텐츠를 저장한다고 가정해보자. 새 이미지 또는 비디오 파일이 업로드되면 사용되는 웹 페이지에 대한 미리보기 이미지를 링크로 생성해주어야 한다. 미리보기 이미지를 수동으로 생성하는 것은 지루하고 시간 소모적인 작업일 수 있다.

  이 경우 업로드된 사진을 기반으로 이미지 크기를 자동으로 조정할 수 있는 Lambda 함수를 생성하고 해당 이미지의 이름을 바꾸고 대상 이미지를 적절한 디렉터리에 저장할 수 있다. 웹 사이트에서 사용하는 Amazon S3 버킷에 원본 이미지 파일을 업로드하는 이벤트 직후에 Lambda 함수가 실행되도록 구성할 수 있다.


# 작동 원리

### EC2

- EC2 인스턴스라고 하는 가상 머신(VM)으로 작업
- 가상 하드웨어(가상 디스크, 네트워크 인터페이스, 프로세서, 메모리)를 EC2 인스턴스에 추가하고 VM 인스턴스를 시작, 중지 및 재부팅할 수 있다.
- EC2 인스턴스는 EBS(Elastic Block Storage) 및 S3 버킷의 두 가지 스토리지 유형과 함께 작동할 수 있다.
- 설치된 운영 체제와 함께 사전 구성된 이미지를 사용하고 사용자 지정 Amazon 머신 이미지(AMI)를 생성할 수 있다.
- EC2 클라우드 서비스는 자동 확장 및 로드 밸런싱을 제공한다.
- EC2 인스턴스는 S3, ECS, Route53, Cloudwatch 등과 같은 대부분의 다른 Amazon 웹 서비스와 함께 작동할 수 있다.

### Lambda

- AWS Lambda를 사용할 때 애플리케이션(Lambda 함수)은 원활한 컨테이너에서 실행된다.
- 컨테이너에는 이미 코드와 라이브러리가 포함되어 있다.
- 리소스는 애플리케이션 요구 사항에 따라 Amazon에서 제공하며  확장에도 용이하다.
- Lambda는 어플리케이션이 작동하고 있는 컨테이너나 작동하고 있는 EC2 인스턴스를 직접 제어할 수 없다. 이 때문에 Lambda의 내부 구조가 어떻게 구성되어 있는 지 파악할 수 없다.
- AWS Lambda는 컨테이너를 사용하여 애플리케이션의 코드 조각을 실행하는 ECS(EC2 Container Service)의 프레임워크로 볼 수 있다.
- 각 컨테이너의 수명 주기는 짧다.
- 실행 중인 Lambda 함수는 상태를 저장하지 않는다. 상태나 결과값을 저장하려면 Amazon S3 버킷 또는 RDS와 같은 데이터 스토리지에 결과를 보관해야 한다.

# 성능 및 가용성

### EC2

- EC2 인스턴스의 전원을 켠 후, 인스턴스는 수동으로 중지하거나 종료 작업을 하기 전까지는 계속 실행된다.
- EC2 인스턴스가 실행 중이라면, 거의 즉시 애플리케이션이 실행된다.
- EC2 인스턴스의 성능이 허용하는 경우, 여러 개의 애플리케이션을 동시에 실행할 수 있다.
- 애플리케이션을 하루 종일 정기적으로 실행해야 하는 경우, ‘EC2 인스턴스’에서 애플리케이션을 실행하는 것이 좋은 솔루션이다.

### Lambda

- Lambda 함수는 항상 사용할 수 있는 상태이지만, 항상 작동하고 있진 않다. 왜냐하면 기본적으로 Lambda는 비활성화 상태를 유지하고 있기 때문이다. Lambda는 이벤트에 연결된 Trigger가 실행될 때에만, Lambda가 실행된다.
- Lambda 함수가 실행되는 Maximum Timeout 시간은 900초(15분)이다. 이러한 특징 때문에 15분 이상 걸리는 작업은 Labmda에서 실행하는 것은 좋은 생각이 아니다. 만약 15분 이상 걸리는 작업을 실행하고 싶다면 AWS EC2 사용을 고려해라.
- AWS EC2에서는 요청을 보내는 것과 어플리케이션을 실행시키는 사이 시점에 시간 지연이 발생하지 않지만, Lambda에서는 100ms 정도의 시간 지연이 발생한다. 100ms가 긴 시간은 아니지만, 특정 어플리케이션에서는 치명적일 수 있다.

  만약 어플리케이션이 특정 데이터를 S3에서 다운받아야 한다면, 어플리케이션을 실행시키기까지 1~3초 정도가 걸린다. 이러한 특징을 염두에 두고 선택을 해야 한다. 이러한 특징은 Lambda의 단점이다. 이런 현상은 일정 시간동안 function이 실행되지 않아서, 컨테이너를 다시 시작해서 function을 실행시켜야 하는 경우에 발생한다.

- function을 일정 시간 동안 실행시키지 않을 경우 컨테이너를 작동시켜 놓지 않기 때문에, 처리해야 하는 작업이 균일하게 발생하지 않는 경우에 대해서 AWS Lambda가 좋은 솔루션이 된다.

# 가격, 요금

### EC2

- 함수/애플리케이션의 실행 여부에 관계없이 AWS EC2 인스턴스가 실행 중인 시간에 대해 비용을 지불한다. 시간당 가격은 EC2 인스턴스에서 사용하는 CPU 성능, 메모리 양, 비디오 카드 성능 및 스토리지 용량에 따라 다르다.
- 정기적인 요청이 많아 기능/애플리케이션을 항상 사용할 수 있어야 하는 경우 AWS EC2 인스턴스를 사용하는 것이 재정적으로 더 합리적일 수 있다.

### Lambda

- 애플리케이션 실행 횟수와 실행을 완료하는 데 필요한 시간에 대해 비용을 지불한다.
- 애플리케이션을 실행하는 1초에 대한 가격은 애플리케이션에 프로비저닝된 메모리 양에 따라 다르며 1GB-초당 $0.00001667입니다. 응용 프로그램 실행 시간은 응용 프로그램 시작부터 결과 반환 또는 시간 초과 후 중지될 때까지 계산된다.

# 결론

### 1.

항상 실행 중인 EC2 인스턴스에서 애플리케이션의 유휴 시간이 많다고 계산했다면 애플리케이션 실행 요청이 없는 경우 유휴 시간에 대한 비용을 지불할 필요가 없는 AWS Lambda를 사용하는 것이 좋다.

애플리케이션 실행에 대한 정기적인 요청이 많은 경우 항상 실행되는 EC2 인스턴스에 애플리케이션을 배포하는 것이 더 나을 수 있다.

### 2.

AWS EC2를 사용하면 고성능 애플리케이션, 장기 실행 애플리케이션 및 시작 시 지연이 없어야 하는 애플리케이션을 실행하는 데 적합하다.

# References

- [AWS Lambda vs. Amazon EC2: Comprehensive Comparison](https://www.nakivo.com/blog/aws-lambda-vs-amazon-ec2-which-one-to-choose/)